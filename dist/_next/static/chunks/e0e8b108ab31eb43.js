(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var a=e.i(43476),t=e.i(75157);function r({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,t.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function s({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,t.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function i({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,t.cn)("leading-none font-semibold",e),...r})}function l({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,t.cn)("text-muted-foreground text-sm",e),...r})}function n({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,t.cn)("px-6",e),...r})}e.s(["Card",()=>r,"CardContent",()=>n,"CardDescription",()=>l,"CardHeader",()=>s,"CardTitle",()=>i])},18566,(e,a,t)=>{a.exports=e.r(76562)},31278,e=>{"use strict";var a=e.i(17521);e.s(["Loader2",()=>a.default])},3408,e=>{"use strict";let a=(0,e.i(75254).default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["default",()=>a])},35501,e=>{"use strict";var a=e.i(3408);e.s(["ImageIcon",()=>a.default])},73375,e=>{"use strict";let a=(0,e.i(75254).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>a],73375)},67027,e=>{"use strict";var a=e.i(71645),t=e.i(75157),r=e.i(41931);function s(){let[e,s]=(0,a.useState)("idle"),[i,l]=(0,a.useState)(null),[n,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),u=(0,a.useCallback)(async e=>{s("analyzing"),o(null);try{let a=await (0,t.compressImage)(e,1024),i=(0,t.extractBase64)(a),n=await (0,r.apiFetch)("/api/analyze",{method:"POST",body:JSON.stringify({image:i})}),o=await n.json();if(!n.ok){if(429===n.status&&"LIMIT_EXCEEDED"===o.code){d(o.usage),s("limit_exceeded");return}throw Error(o.error||"Analysis failed")}o.usage&&d(o.usage),l(o),s("result")}catch(e){o(e instanceof Error?e.message:"Failed to analyze image"),s("error")}},[]);return{stage:e,analysisData:i,error:n,usage:c,analyze:u,reset:(0,a.useCallback)(()=>{s("idle"),o(null),l(null)},[]),dismissLimitModal:(0,a.useCallback)(()=>{s("idle")},[]),isLimitExceeded:"limit_exceeded"===e}}e.s(["useAnalyze",()=>s])},9802,e=>{"use strict";var a,t,r,s,i,l,n=e.i(43476),o=e.i(71645),c=e.i(18566),d=e.i(15288),u=e.i(19455),m=e.i(68553),p=e.i(35501),h=e.i(31278),g=e.i(73375),x=e.i(82568),f=x;(a=s||(s={})).Prompt="PROMPT",a.Camera="CAMERA",a.Photos="PHOTOS",(t=i||(i={})).Rear="REAR",t.Front="FRONT",(r=l||(l={})).Uri="uri",r.Base64="base64",r.DataUrl="dataUrl";class b extends f.WebPlugin{async getPhoto(e){return new Promise(async(a,t)=>{if(e.webUseInput||e.source===s.Photos)this.fileInputExperience(e,a,t);else if(e.source===s.Prompt){let r=document.querySelector("pwa-action-sheet");r||(r=document.createElement("pwa-action-sheet"),document.body.appendChild(r)),r.header=e.promptLabelHeader||"Photo",r.cancelable=!1,r.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],r.addEventListener("onSelection",async r=>{0===r.detail?this.fileInputExperience(e,a,t):this.cameraExperience(e,a,t)})}else this.cameraExperience(e,a,t)})}async pickImages(e){return new Promise(async(e,a)=>{this.multipleFileInputExperience(e,a)})}async cameraExperience(e,a,t){if(customElements.get("pwa-camera-modal")){let r=document.createElement("pwa-camera-modal");r.facingMode=e.direction===i.Front?"user":"environment",document.body.appendChild(r);try{await r.componentOnReady(),r.addEventListener("onPhoto",async s=>{let i=s.detail;null===i?t(new f.CapacitorException("User cancelled photos app")):i instanceof Error?t(i):a(await this._getCameraPhoto(i,e)),r.dismiss(),document.body.removeChild(r)}),r.present()}catch(r){this.fileInputExperience(e,a,t)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,a,t)}fileInputExperience(e,a,t){let r=document.querySelector("#_capacitor-camera-input"),l=()=>{var e;null==(e=r.parentNode)||e.removeChild(r)};r||((r=document.createElement("input")).id="_capacitor-camera-input",r.type="file",r.hidden=!0,document.body.appendChild(r),r.addEventListener("change",t=>{let s=r.files[0],i="jpeg";if("image/png"===s.type?i="png":"image/gif"===s.type&&(i="gif"),"dataUrl"===e.resultType||"base64"===e.resultType){let t=new FileReader;t.addEventListener("load",()=>{"dataUrl"===e.resultType?a({dataUrl:t.result,format:i}):"base64"===e.resultType&&a({base64String:t.result.split(",")[1],format:i}),l()}),t.readAsDataURL(s)}else a({webPath:URL.createObjectURL(s),format:i}),l()}),r.addEventListener("cancel",e=>{t(new f.CapacitorException("User cancelled photos app")),l()})),r.accept="image/*",r.capture=!0,e.source===s.Photos||e.source===s.Prompt?r.removeAttribute("capture"):e.direction===i.Front?r.capture="user":e.direction===i.Rear&&(r.capture="environment"),r.click()}multipleFileInputExperience(e,a){let t=document.querySelector("#_capacitor-camera-input-multiple"),r=()=>{var e;null==(e=t.parentNode)||e.removeChild(t)};t||((t=document.createElement("input")).id="_capacitor-camera-input-multiple",t.type="file",t.hidden=!0,t.multiple=!0,document.body.appendChild(t),t.addEventListener("change",a=>{let s=[];for(let e=0;e<t.files.length;e++){let a=t.files[e],r="jpeg";"image/png"===a.type?r="png":"image/gif"===a.type&&(r="gif"),s.push({webPath:URL.createObjectURL(a),format:r})}e({photos:s}),r()}),t.addEventListener("cancel",e=>{a(new f.CapacitorException("User cancelled photos app")),r()})),t.accept="image/*",t.click()}_getCameraPhoto(e,a){return new Promise((t,r)=>{let s=new FileReader,i=e.type.split("/")[1];"uri"===a.resultType?t({webPath:URL.createObjectURL(e),format:i,saved:!1}):(s.readAsDataURL(e),s.onloadend=()=>{let e=s.result;"dataUrl"===a.resultType?t({dataUrl:e,format:i,saved:!1}):t({base64String:e.split(",")[1],format:i,saved:!1})},s.onerror=e=>{r(e)})})}async checkPermissions(){if("undefined"==typeof navigator||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch(e){throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}new b;let y=(0,x.registerPlugin)("Camera",{web:()=>new b});var w=e.i(46696),v=e.i(67027),C=e.i(22016);function j(){let e=(0,c.useRouter)(),[a,t]=(0,o.useState)(null),{takePhoto:r,selectFromGallery:i,isLoading:f,isNative:b}=function(e={}){let[a,t]=(0,o.useState)(!1),[r,i]=(0,o.useState)(()=>x.Capacitor.isNativePlatform()),n=(0,o.useCallback)(async()=>{if(!r)return!0;try{let e=await y.requestPermissions();return"granted"===e.camera}catch{return!1}},[r]),c=(0,o.useCallback)(async()=>{t(!0);try{if(r){if(!await n())throw Error("Camera permission denied");let a=await y.getPhoto({quality:90,allowEditing:!1,resultType:l.Base64,source:s.Camera});if(a.base64String){let t=`data:image/jpeg;base64,${a.base64String}`;return e.onImageCapture?.(t),t}}return null}catch(t){let a=t instanceof Error?t:Error("Failed to take photo");throw e.onError?.(a),a}finally{t(!1)}},[r,n,e]),d=(0,o.useCallback)(async()=>{t(!0);try{if(r){let a=await y.getPhoto({quality:90,allowEditing:!1,resultType:l.Base64,source:s.Photos});if(a.base64String){let t=`data:image/jpeg;base64,${a.base64String}`;return e.onImageCapture?.(t),t}}return null}catch(t){let a=t instanceof Error?t:Error("Failed to select photo");throw e.onError?.(a),a}finally{t(!1)}},[r,e]);return{isNative:r,isLoading:a,takePhoto:c,selectFromGallery:d,requestPermissions:n}}({onImageCapture:e=>{t(e)},onError:e=>{w.toast.error(e.message)}}),{analyze:j,stage:E,analysisData:P}=(0,v.useAnalyze)(),N="analyzing"===E;(0,o.useEffect)(()=>{P?.id&&e.push(`/analysis/${P.id}`)},[P,e]);let L=async()=>{try{await r()}catch{}},k=async()=>{try{await i()}catch{}},U=async()=>{a&&await j(a)};return b?(0,n.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,n.jsx)(C.default,{href:"/",children:(0,n.jsx)(u.Button,{variant:"ghost",size:"icon",className:"text-slate-400",children:(0,n.jsx)(g.ChevronLeft,{className:"w-5 h-5"})})}),(0,n.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Take Photo"})]}),a?(0,n.jsxs)(d.Card,{className:"bg-slate-800/50 border-slate-700 overflow-hidden",children:[(0,n.jsx)("div",{className:"aspect-square bg-slate-900 relative",children:(0,n.jsx)("img",{src:a,alt:"Captured",className:"w-full h-full object-contain"})}),(0,n.jsxs)("div",{className:"p-4 flex gap-3",children:[(0,n.jsx)(u.Button,{onClick:()=>{t(null)},variant:"outline",className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-700",children:"Retake"}),(0,n.jsxs)(u.Button,{onClick:U,disabled:N,className:"flex-1 bg-purple-600 hover:bg-purple-700",children:[N?(0,n.jsx)(h.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}):(0,n.jsx)(m.Camera,{className:"w-4 h-4 mr-2"}),"Analyze"]})]})]}):(0,n.jsx)(d.Card,{className:"bg-slate-800/50 border-slate-700 p-8",children:(0,n.jsxs)("div",{className:"text-center space-y-6",children:[(0,n.jsx)("div",{className:"w-20 h-20 mx-auto rounded-full bg-purple-600/20 flex items-center justify-center",children:(0,n.jsx)(m.Camera,{className:"w-10 h-10 text-purple-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"Capture Vocabulary"}),(0,n.jsx)("p",{className:"text-slate-400",children:"Take a photo of objects around you to learn their names in Chinese"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)(u.Button,{onClick:L,disabled:f,className:"bg-purple-600 hover:bg-purple-700 h-14 text-lg",children:[f?(0,n.jsx)(h.Loader2,{className:"w-5 h-5 mr-2 animate-spin"}):(0,n.jsx)(m.Camera,{className:"w-5 h-5 mr-2"}),"Take Photo"]}),(0,n.jsxs)(u.Button,{onClick:k,disabled:f,variant:"outline",className:"border-slate-600 text-slate-300 hover:bg-slate-700 h-14",children:[(0,n.jsx)(p.ImageIcon,{className:"w-5 h-5 mr-2"}),"Choose from Gallery"]})]})]})})]}):(0,n.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-2xl text-center",children:[(0,n.jsx)("p",{className:"text-slate-400 mb-4",children:"Native camera is only available in the mobile app."}),(0,n.jsx)(C.default,{href:"/capture",children:(0,n.jsx)(u.Button,{className:"bg-purple-600 hover:bg-purple-700",children:"Use Web Camera"})})]})}e.s(["default",()=>j],9802)}]);