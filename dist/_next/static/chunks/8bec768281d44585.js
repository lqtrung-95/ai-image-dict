(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476),a=e.i(75157);function s({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function r({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function l({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...s})}function i({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...s})}function o({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>o,"CardDescription",()=>i,"CardHeader",()=>r,"CardTitle",()=>l])},18566,(e,t,a)=>{t.exports=e.r(76562)},27612,e=>{"use strict";let t=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],27612)},82373,e=>{"use strict";let t=(0,e.i(75254).default)("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);e.s(["Volume2",()=>t],82373)},83086,e=>{"use strict";let t=(0,e.i(75254).default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);e.s(["Sparkles",()=>t],83086)},3408,e=>{"use strict";let t=(0,e.i(75254).default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["default",()=>t])},73375,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>t],73375)},35501,e=>{"use strict";var t=e.i(3408);e.s(["ImageIcon",()=>t.default])},2426,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(15288),l=e.i(19455),i=e.i(73375),o=e.i(27612),n=e.i(35501),c=e.i(10980),d=e.i(82373);let h=(0,e.i(75254).default)("volume-x",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);var m=e.i(83086),x=e.i(46696),u=e.i(22016),p=e.i(41931);function y(){let e=(0,s.useParams)(),y=(0,s.useRouter)(),[b,j]=(0,a.useState)(null),[g,f]=(0,a.useState)(!0),[v,N]=(0,a.useState)(!1),w=e.id;(0,a.useEffect)(()=>{k()},[w]);let k=async()=>{try{let e=await (0,p.apiFetch)(`/api/stories/${w}`);if(e.ok){let t=await e.json();j(t.story)}else x.toast.error("Story not found"),y.push("/stories")}catch(e){x.toast.error("Failed to load story")}finally{f(!1)}},S=async()=>{N(!0);try{let e=await (0,p.apiFetch)(`/api/stories/${w}`,{method:"POST"});if(e.ok){let t=await e.json();j(t.story),x.toast.success("Story generated!")}else throw Error("Failed to generate story")}catch(e){x.toast.error("Failed to generate story")}finally{N(!1)}},C=async()=>{if(confirm("Are you sure you want to delete this story?"))try{(await (0,p.apiFetch)(`/api/stories/${w}`,{method:"DELETE"})).ok&&(x.toast.success("Story deleted"),y.push("/stories"))}catch(e){x.toast.error("Failed to delete story")}},[L,_]=(0,a.useState)(null),F=async(e,t="story")=>{if(L===t){window.speechSynthesis.cancel(),_(null);return}_(t);try{let t=await (0,p.apiFetch)("/api/tts",{method:"POST",body:JSON.stringify({text:e,lang:"zh-CN"})});if(t.ok){let a=await t.blob(),s=URL.createObjectURL(a),r=new Audio(s);r.onended=()=>{_(null),URL.revokeObjectURL(s)},r.onerror=()=>{_(null),URL.revokeObjectURL(s),M(e)},await r.play()}else if(503===t.status)M(e),_(null);else throw Error("TTS failed")}catch{M(e),_(null)}},M=e=>{let t=new SpeechSynthesisUtterance(e);t.lang="zh-CN",t.rate=.8,t.onend=()=>_(null),window.speechSynthesis.speak(t)};return g?(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[(0,t.jsx)("div",{className:"h-8 w-48 bg-slate-800/50 rounded animate-pulse mb-6"}),(0,t.jsx)("div",{className:"h-64 bg-slate-800/50 rounded-xl animate-pulse"})]}):b?(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)(u.default,{href:"/stories",children:(0,t.jsxs)(l.Button,{variant:"ghost",className:"-ml-2 text-slate-400",children:[(0,t.jsx)(i.ChevronLeft,{className:"w-4 h-4 mr-1"}),"Back to Stories"]})}),(0,t.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:C,className:"border-red-500/30 text-red-400 hover:bg-red-500/10",children:[(0,t.jsx)(o.Trash2,{className:"w-4 h-4 mr-2"}),"Delete"]})]}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:b.title}),b.description&&(0,t.jsx)("p",{className:"text-slate-400",children:b.description}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-4 text-sm text-slate-500",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(n.ImageIcon,{className:"w-4 h-4"}),b.photos.length," photos"]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(c.BookOpen,{className:"w-4 h-4"}),b.vocabularyCount," unique words"]}),(0,t.jsxs)("span",{className:"text-slate-600",children:["(",b.totalVocabularyItems," total items)"]})]})]}),b.generated_content?.storyZh?(0,t.jsxs)(r.Card,{className:"bg-gradient-to-br from-purple-900/30 to-slate-800/50 border-purple-500/30 p-6 mb-8",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)(m.Sparkles,{className:"w-5 h-5 text-purple-400"}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-white",children:"AI-Generated Story"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-slate-900/50 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-lg text-white leading-relaxed",children:b.generated_content.storyZh})}),b.generated_content.storyPinyin&&(0,t.jsx)("div",{className:"text-slate-400 text-sm italic",children:b.generated_content.storyPinyin}),b.generated_content.storyEn&&(0,t.jsx)("div",{className:"text-slate-300 text-sm border-t border-slate-700 pt-3",children:b.generated_content.storyEn}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>F(b.generated_content.storyZh,"story"),disabled:"story"===L,className:"border-purple-500/30 text-purple-400 hover:bg-purple-500/10",children:"story"===L?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h,{className:"w-4 h-4 mr-2"}),"Playing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Volume2,{className:"w-4 h-4 mr-2"}),"Listen"]})})]})]}):(0,t.jsx)(r.Card,{className:"bg-slate-800/50 border-slate-700 border-dashed p-6 mb-8",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(m.Sparkles,{className:"w-8 h-8 text-slate-500 mx-auto mb-3"}),(0,t.jsx)("h3",{className:"text-white font-medium mb-2",children:"Generate a Story"}),(0,t.jsx)("p",{className:"text-slate-400 text-sm mb-4",children:"Let AI create a short story using the vocabulary from your photos"}),(0,t.jsx)(l.Button,{onClick:S,disabled:v||0===b.vocabularyCount,className:"bg-purple-600 hover:bg-purple-700",children:v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 mr-2 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Generating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Sparkles,{className:"w-4 h-4 mr-2"}),"Generate Story"]})})]})}),(0,t.jsx)("div",{className:"space-y-6 mb-8",children:b.photos.map((e,a)=>(0,t.jsxs)(r.Card,{className:"bg-slate-800/50 border-slate-700 overflow-hidden",children:[(0,t.jsx)("div",{className:"aspect-video bg-slate-700",children:(0,t.jsx)("img",{src:e.image_url,alt:`Photo ${a+1}`,className:"w-full h-full object-cover"})}),e.caption&&(0,t.jsx)("div",{className:"p-4 border-b border-slate-700/50",children:(0,t.jsx)("p",{className:"text-slate-300",children:e.caption})}),e.vocabulary&&e.vocabulary.length>0&&(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-slate-400 mb-3",children:["Detected Words (",e.vocabulary.length,")"]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:e.vocabulary.map(e=>(0,t.jsxs)("button",{onClick:()=>F(e.label_zh,e.id),className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg border transition-colors hover:opacity-80 ${(e=>{switch(e){case"color":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"action":return"bg-orange-500/20 text-orange-400 border-orange-500/30";default:return"bg-emerald-500/20 text-emerald-400 border-emerald-500/30"}})(e.category)}`,children:[(0,t.jsx)("span",{className:"font-medium",children:e.label_zh}),(0,t.jsx)("span",{className:"text-xs opacity-80",children:e.pinyin}),(0,t.jsxs)("span",{className:"text-xs opacity-60",children:["Â· ",e.label_en]}),L===e.id?(0,t.jsx)(h,{className:"w-3 h-3 ml-1"}):(0,t.jsx)(d.Volume2,{className:"w-3 h-3 ml-1"})]},e.id))})]}),(!e.vocabulary||0===e.vocabulary.length)&&(0,t.jsx)("div",{className:"p-4 text-sm text-slate-500",children:"No words detected in this photo."})]},e.id))})]}):null}e.s(["default",()=>y],2426)}]);