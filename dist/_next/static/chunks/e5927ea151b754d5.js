(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,s)=>{t.exports=e.r(76562)},80696,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(19455),r=e.i(68553);let l=(0,e.i(75254).default)("switch-camera",[["path",{d:"M11 19H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5",key:"mtk2lu"}],["path",{d:"M13 5h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5",key:"120jsl"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m18 22-3-3 3-3",key:"kgdoj7"}],["path",{d:"m6 2 3 3-3 3",key:"1fnbkv"}]]);var i=e.i(37727),n=e.i(63209),c=e.i(75157);function o({onCapture:e,onClose:o,className:d}){let{videoRef:m,error:u,isReady:h,startCamera:x,stopCamera:p,switchCamera:g,capturePhoto:b}=function(){let e=(0,s.useRef)(null),[t,a]=(0,s.useState)(null),[r,l]=(0,s.useState)(null),[i,n]=(0,s.useState)(!1),[c,o]=(0,s.useState)("environment"),d=(0,s.useCallback)(async(s="environment")=>{try{l(null),n(!1),t&&t.getTracks().forEach(e=>e.stop());let r=await navigator.mediaDevices.getUserMedia({video:{facingMode:s,width:{ideal:1920},height:{ideal:1080}},audio:!1});e.current?(e.current.srcObject=r,await new Promise((t,s)=>{let a=e.current;if(!a)return void s(Error("Video element not found"));let r=()=>{a.removeEventListener("canplay",r),a.removeEventListener("error",l),t()},l=()=>{a.removeEventListener("canplay",r),a.removeEventListener("error",l),s(Error("Video failed to load"))};a.addEventListener("canplay",r),a.addEventListener("error",l)}),e.current?(await e.current.play(),a(r),o(s),n(!0)):r.getTracks().forEach(e=>e.stop())):r.getTracks().forEach(e=>e.stop())}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;l(e instanceof Error?"NotAllowedError"===e.name?"Camera access denied. Please enable camera permissions in your browser settings.":"NotFoundError"===e.name?"No camera found on this device.":`Camera error: ${e.message}`:"Failed to access camera"),n(!1)}},[t]),m=(0,s.useCallback)(()=>{t&&(t.getTracks().forEach(e=>e.stop()),a(null)),e.current&&(e.current.srcObject=null),n(!1)},[t]),u=(0,s.useCallback)(()=>{d("user"===c?"environment":"user")},[c,d]),h=(0,s.useCallback)(()=>{if(!e.current||!i)return null;let t=e.current,s=document.createElement("canvas");s.width=t.videoWidth,s.height=t.videoHeight;let a=s.getContext("2d");return a?("user"===c&&(a.translate(s.width,0),a.scale(-1,1)),a.drawImage(t,0,0),s.toDataURL("image/jpeg",.85)):null},[i,c]);return(0,s.useEffect)(()=>()=>{t&&t.getTracks().forEach(e=>e.stop())},[t]),{videoRef:e,stream:t,error:r,isReady:i,facingMode:c,startCamera:d,stopCamera:m,switchCamera:u,capturePhoto:h}}(),f=(0,s.useRef)(!1);return((0,s.useEffect)(()=>(f.current||(f.current=!0,x("environment")),()=>{p()}),[]),u)?(0,t.jsxs)("div",{className:(0,c.cn)("flex flex-col items-center justify-center p-8 text-center",d),children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mb-4",children:(0,t.jsx)(n.AlertCircle,{className:"w-8 h-8 text-red-400"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"Camera Access Required"}),(0,t.jsx)("p",{className:"text-slate-400 mb-4 max-w-sm",children:u}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(a.Button,{onClick:()=>x("environment"),className:"bg-purple-600 hover:bg-purple-700",children:"Try Again"}),o&&(0,t.jsx)(a.Button,{variant:"outline",onClick:o,className:"border-slate-600",children:"Cancel"})]})]}):(0,t.jsxs)("div",{className:(0,c.cn)("relative bg-black rounded-xl overflow-hidden",d),children:[(0,t.jsx)("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(1)"}}),!h&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-slate-400",children:"Initializing camera..."})]})}),h&&(0,t.jsx)("div",{className:"absolute inset-x-0 bottom-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,t.jsx)(a.Button,{variant:"outline",size:"icon",onClick:g,className:"rounded-full bg-white/10 border-white/20 text-white hover:bg-white/20",children:(0,t.jsx)(l,{className:"w-5 h-5"})}),(0,t.jsx)(a.Button,{size:"lg",onClick:()=>{let t=b();t&&(p(),e(t))},className:"rounded-full w-16 h-16 bg-white hover:bg-slate-100 text-slate-900",children:(0,t.jsx)(r.Camera,{className:"w-6 h-6"})}),o&&(0,t.jsx)(a.Button,{variant:"outline",size:"icon",onClick:()=>{p(),o()},className:"rounded-full bg-white/10 border-white/20 text-white hover:bg-white/20",children:(0,t.jsx)(i.X,{className:"w-5 h-5"})})]})}),h&&(0,t.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,t.jsx)("div",{className:"absolute top-4 left-4 w-8 h-8 border-l-2 border-t-2 border-white/50"}),(0,t.jsx)("div",{className:"absolute top-4 right-4 w-8 h-8 border-r-2 border-t-2 border-white/50"}),(0,t.jsx)("div",{className:"absolute bottom-20 left-4 w-8 h-8 border-l-2 border-b-2 border-white/50"}),(0,t.jsx)("div",{className:"absolute bottom-20 right-4 w-8 h-8 border-r-2 border-b-2 border-white/50"})]})]})}e.s(["CameraCapture",()=>o],80696)},83086,e=>{"use strict";let t=(0,e.i(75254).default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);e.s(["Sparkles",()=>t],83086)},16715,e=>{"use strict";let t=(0,e.i(75254).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],16715)},37727,e=>{"use strict";var t=e.i(41947);e.s(["X",()=>t.default])},63209,e=>{"use strict";let t=(0,e.i(75254).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},78894,e=>{"use strict";var t=e.i(82458);e.s(["AlertTriangle",()=>t.default])},52702,e=>{"use strict";var t=e.i(71645);function s(){let[e,s]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{let e=()=>{let e="ontouchstart"in window||navigator.maxTouchPoints>0,t=window.matchMedia("(max-width: 768px)").matches;s(e&&t)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}e.s(["useIsMobile",()=>s])},6039,e=>{"use strict";var t=e.i(43476),s=e.i(2747);function a(){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(s.Skeleton,{className:"w-full aspect-video rounded-xl bg-slate-700"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Skeleton,{className:"h-4 w-32 bg-slate-700"}),(0,t.jsx)(s.Skeleton,{className:"h-6 w-full bg-slate-700"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Skeleton,{className:"h-4 w-40 bg-slate-700"}),(0,t.jsx)("div",{className:"grid gap-4 grid-cols-2 md:grid-cols-3",children:Array.from({length:6}).map((e,a)=>(0,t.jsxs)("div",{className:"p-4 rounded-xl bg-slate-800/50 border border-slate-700",children:[(0,t.jsx)(s.Skeleton,{className:"h-10 w-16 mb-2 bg-slate-700"}),(0,t.jsx)(s.Skeleton,{className:"h-4 w-12 mb-1 bg-slate-700"}),(0,t.jsx)(s.Skeleton,{className:"h-3 w-20 bg-slate-700"})]},a))})]})]})}function r(){return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsxs)("div",{className:"relative mb-6",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-purple-500/20 animate-pulse"}),(0,t.jsx)("div",{className:"absolute inset-0 w-20 h-20 rounded-full border-2 border-purple-500 border-t-transparent animate-spin"})]}),(0,t.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"Analyzing your photo..."}),(0,t.jsx)("p",{className:"text-slate-400 max-w-sm",children:"Our AI is detecting objects and translating them to Chinese. This usually takes a few seconds."})]})}e.s(["AnalysisSkeleton",()=>a,"AnalyzingState",()=>r])},72080,e=>{"use strict";let t=(0,e.i(75254).default)("image-plus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);e.s(["ImagePlus",()=>t],72080)},66001,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(19455),r=e.i(78894);function l({title:e="Error",message:s,onRetry:l}){return(0,t.jsx)("div",{className:"p-4 rounded-lg bg-red-900/20 border border-red-800",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(r.AlertTriangle,{className:"w-5 h-5 text-red-400 mt-0.5"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-medium text-red-400",children:e}),(0,t.jsx)("p",{className:"text-sm text-red-300/80 mt-1",children:s}),l&&(0,t.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:l,className:"mt-2 text-red-400 hover:text-red-300 hover:bg-red-900/20 p-0 h-auto",children:"Try again"})]})]})})}e.i(16715),s.Component,e.s(["ErrorMessage",()=>l])},67027,e=>{"use strict";var t=e.i(71645),s=e.i(75157),a=e.i(41931);function r(){let[e,r]=(0,t.useState)("idle"),[l,i]=(0,t.useState)(null),[n,c]=(0,t.useState)(null),[o,d]=(0,t.useState)(null),m=(0,t.useCallback)(async e=>{r("analyzing"),c(null);try{let t=await (0,s.compressImage)(e,1024),l=(0,s.extractBase64)(t),n=await (0,a.apiFetch)("/api/analyze",{method:"POST",body:JSON.stringify({image:l})}),c=await n.json();if(!n.ok){if(429===n.status&&"LIMIT_EXCEEDED"===c.code){d(c.usage),r("limit_exceeded");return}throw Error(c.error||"Analysis failed")}c.usage&&d(c.usage),i(c),r("result")}catch(e){c(e instanceof Error?e.message:"Failed to analyze image"),r("error")}},[]);return{stage:e,analysisData:l,error:n,usage:o,analyze:m,reset:(0,t.useCallback)(()=>{r("idle"),c(null),i(null)},[]),dismissLimitModal:(0,t.useCallback)(()=>{r("idle")},[]),isLimitExceeded:"limit_exceeded"===e}}e.s(["useAnalyze",()=>r])},39312,e=>{"use strict";let t=(0,e.i(75254).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>t],39312)},36339,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(76639),r=e.i(19455),l=e.i(55764),i=e.i(83086),n=e.i(39312),c=e.i(68553),o=e.i(10980),d=e.i(43531),m=e.i(46696),u=e.i(41931);let h=[{icon:c.Camera,text:"Unlimited photo analyses"},{icon:o.BookOpen,text:"Unlimited vocabulary saves"},{icon:n.Zap,text:"Priority AI processing"},{icon:i.Sparkles,text:"No daily limits"}];function x({open:e,onClose:n,usage:c}){let[o,x]=(0,s.useState)(""),[p,g]=(0,s.useState)(!1),[b,f]=(0,s.useState)(!1),v=async()=>{g(!0);try{(await (0,u.apiFetch)("/api/upgrade-interest",{method:"POST",body:JSON.stringify({email:o||null,reason:"limit_reached"})})).ok?(f(!0),m.toast.success("Thanks! We'll notify you when Premium launches.")):m.toast.error("Something went wrong. Please try again.")}catch{m.toast.error("Something went wrong. Please try again.")}finally{g(!1)}};return(0,t.jsx)(a.Dialog,{open:e,onOpenChange:e=>!e&&n(),children:(0,t.jsxs)(a.DialogContent,{className:"sm:max-w-md bg-slate-900 border-slate-700",children:[(0,t.jsx)(a.DialogHeader,{children:(0,t.jsx)(a.DialogTitle,{className:"text-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:(0,t.jsx)(i.Sparkles,{className:"w-8 h-8 text-white"})}),(0,t.jsx)("span",{className:"text-2xl font-bold text-white",children:"Daily Limit Reached"})]})})}),(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[c&&(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("p",{className:"text-slate-400",children:["You've used"," ",(0,t.jsxs)("span",{className:"text-white font-semibold",children:[c.current,"/",c.limit]})," ","free analyses today"]}),(0,t.jsx)("div",{className:"mt-2 h-2 bg-slate-700 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all",style:{width:`${Math.min(100,c.current/c.limit*100)}%`}})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-sm text-slate-400 text-center",children:"Upgrade to Premium for unlimited access:"}),(0,t.jsx)("div",{className:"grid gap-2",children:h.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/50 border border-slate-700",children:[(0,t.jsx)(e.icon,{className:"w-5 h-5 text-purple-400"}),(0,t.jsx)("span",{className:"text-slate-200",children:e.text})]},e.text))})]}),b?(0,t.jsxs)("div",{className:"text-center p-4 rounded-lg bg-green-500/10 border border-green-500/30",children:[(0,t.jsx)(d.Check,{className:"w-8 h-8 text-green-400 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-green-400 font-medium",children:"You're on the list!"}),(0,t.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:"We'll email you when Premium is ready."})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-sm text-slate-400 text-center",children:"Premium is coming soon! Get notified:"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(l.Input,{type:"email",placeholder:"your@email.com (optional)",value:o,onChange:e=>x(e.target.value),className:"bg-slate-800 border-slate-700 text-white placeholder:text-slate-500"}),(0,t.jsx)(r.Button,{onClick:v,disabled:p,className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 whitespace-nowrap",children:p?"Saving...":"Notify Me"})]})]}),(0,t.jsxs)("p",{className:"text-xs text-slate-500 text-center",children:["Your free analyses reset at midnight UTC.",(0,t.jsx)("br",{}),"Come back tomorrow for ",c?.limit||6," more!"]})]})]})})}e.s(["UpgradeModal",()=>x])},2597,e=>{"use strict";var t=e.i(43476),s=e.i(18566),a=e.i(80696),r=e.i(6039),l=e.i(59185),i=e.i(66001),n=e.i(36339),c=e.i(67027),o=e.i(41931);function d(){let e=(0,s.useRouter)(),{stage:d,analysisData:m,error:u,usage:h,analyze:x,reset:p,dismissLimitModal:g,isLimitExceeded:b}=(0,c.useAnalyze)(),f=async e=>{let t=await (0,o.apiFetch)("/api/vocabulary",{method:"POST",body:JSON.stringify(e)});if(!t.ok&&409!==t.status)throw Error("Failed to save word")},v="idle"===d||"limit_exceeded"===d?"capture":d;return(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold text-white mb-6",children:["capture"===v&&"Capture Photo","analyzing"===v&&"Analyzing...","result"===v&&"Analysis Results","error"===v&&"Error"]}),h&&"capture"===v&&(0,t.jsxs)("div",{className:"mb-4 p-3 rounded-lg bg-slate-800/50 border border-slate-700",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Daily analyses"}),(0,t.jsxs)("span",{className:"text-slate-300",children:[h.remaining," of ",h.limit," remaining"]})]}),(0,t.jsx)("div",{className:"h-1.5 bg-slate-700 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all",style:{width:`${(h.limit-h.remaining)/h.limit*100}%`}})})]}),"capture"===v&&(0,t.jsx)(a.CameraCapture,{onCapture:x,onClose:()=>e.push("/"),className:"aspect-[4/3] max-h-[70vh]"}),"analyzing"===v&&(0,t.jsx)(r.AnalyzingState,{}),"result"===v&&m&&(0,t.jsx)(l.AnalysisResult,{id:m.id,imageUrl:m.imageUrl,sceneDescription:m.sceneDescription,sceneDescriptionZh:m.sceneDescriptionZh,sceneDescriptionPinyin:m.sceneDescriptionPinyin,objects:m.objects,exampleSentences:m.exampleSentences,hskLevels:m.hskLevels,onSaveWord:f,onUploadAnother:p}),"error"===v&&(0,t.jsx)(i.ErrorMessage,{title:"Analysis Failed",message:u||"Something went wrong. Please try again.",onRetry:p}),(0,t.jsx)(n.UpgradeModal,{open:b,onClose:g,usage:h?{current:h.current,limit:h.limit}:void 0})]})}e.s(["default",()=>d])}]);